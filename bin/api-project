#!/usr/bin/env node
const program = require("commander");
const request = require("request");
const chalk = require("chalk");
const config = require("../config.js");

program
  .command("list [project-name]")
  .description("display project list")
  .action(function(projectName) {
    const url = projectName
      ? `${config.host}/projects?identity=${projectName}`
      : `${config.host}/projects`;
    request(url, function(error, response, body) {
      if (error) {
        chalk.red(error);
      }
      if (!error && response.statusCode === 200) {
        body = JSON.parse(body);
        console.info(body.data);
      }
    });
  });

program
  .command("add <project-name>")
  .description("add a project")
  .option("-n, --name <name>", "project chinese name")
  .option("-t, --target <target>", "the target project's proxied")
  .action(function(projectName, cmd) {
    const url = projectName
      ? `${config.host}/projects?identity=${projectName}`
      : `${config.host}/projects`;
    request(url, function(error, response, body) {
      if (error) {
        chalk.red(error);
      }
      if (!error && response.statusCode === 200) {
        body = JSON.parse(body);
        console.info(body.data);
      }
    });
  });

program.parse(process.argv);
