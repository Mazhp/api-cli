#!/usr/bin/env node
const program = require("commander");
const request = require("request");
const chalk = require("chalk");
const logger = require("../lib/logger");
const config = require("../config.js");
const db = require("../lib/dbinit");

program
  .command("list")
  .option("-u, --url [url]", "interface req url")
  .option("-m, --method [method]", "interface req method")
  .description("search interface list")
  .action(function(cmd) {
    const workProject = db.get("workProject").value();
    if (!workProject)
      logger.fatal("current work project isn't setted, please go to set.");

    const { url, method } = cmd;
    request(
      {
        url: "",
        qs: ""
      },
      function(error, response, body) {
        if (error) {
          logger.fatal(error);
        }
        if (!error && response.statusCode === 200) {
          body = JSON.parse(body);
          //如果是查询所有项目,存储他们，作为后面命名检查使用
          if (url.indexOf("identity") === -1) {
            storeAllProject(body.data);
          }
          logger.success(body.data);
        }
      }
    );
  });

program.parse(process.argv);
